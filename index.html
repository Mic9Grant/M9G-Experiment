<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Michael 9 Grant Experiment</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a4d69, #4b86b4);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 40px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .progress-container {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 20px 40px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .content {
            padding: 30px 40px;
            min-height: 500px;
        }
        
        .section {
            display: none;
        }
        
        .active {
            display: block;
            animation: fadeIn 0.8s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .concept-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .concept-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .concept-card h3 {
            color: #3498db;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .concept-card h3 i {
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #3498db;
            color: white;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.4);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-next {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
        }
        
        .btn-prev {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }
        
        .experiment-info {
            background: #e3f2fd;
            border-left: 5px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
        
        .condition-display {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .task-container {
            background: #f5f7fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .slider {
            width: 100%;
            height: 25px;
            -webkit-appearance: none;
            background: #e0e0e0;
            border-radius: 12px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .allocation-display {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            text-align: center;
        }
        
        .participant-box {
            padding: 15px;
            border-radius: 10px;
            background: #e3f2fd;
            width: 28%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .participant-box.self {
            background: #d1ecf1;
            border: 2px solid #3498db;
            transform: scale(1.05);
        }
        
        .points-display {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .round-indicator {
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            color: #3498db;
        }
        
        .chart-container {
            margin: 30px 0;
            height: 300px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .result-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        
        .comparison {
            font-style: italic;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        .debrief {
            background: #e8f5e9;
            border-left: 5px solid #4CAF50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: white;
            font-size: 0.9rem;
        }
        
        .theory-highlight {
            background: #fff3cd;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: #856404;
        }
        
        @media (max-width: 768px) {
            .concept-grid {
                grid-template-columns: 1fr;
            }
            
            .allocation-display {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .participant-box {
                width: 80%;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>The Michael 9 Grant Experiment</h1>
            <div class="subtitle">Examining how power, social roles, and monetary incentives influence self-serving behavior</div>
        </header>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="content">
            <!-- Introduction Section -->
            <div class="section active" id="intro">
                <h2>Understanding the Experiment</h2>
                <p>Welcome to "The Michael 9 Grant Experiment" - an interactive simulation exploring how power dynamics, social roles, and financial incentives influence human behavior in organizational settings.</p>
                
                <div class="experiment-info">
                    <p>This experiment examines how these factors can lead to self-serving decision-making, reduced empathy, and punitive behavior. Based on psychological research. We'll explore how ordinary people can behave differently when placed in positions of authority with financial incentives.</p>
                </div>
                
                <h3>Core Concepts:</h3>
                <div class="concept-grid">
                    <div class="concept-card">
                        <h3>💪 Power</h3>
                        <p>The ability to influence others' behavior. High power reduces empathy and increases self-focus. In this experiment, power is operationalized as <span class="theory-highlight">high-control</span> (decisive authority) vs <span class="theory-highlight">low-control</span> (recommendation only).</p>
                    </div>
                    <div class="concept-card">
                        <h3>🎭 Social Roles</h3>
                        <p>Sets of connected behaviors and expectations. Participants are assigned as either <span class="theory-highlight">Authority</span> (leader) or <span class="theory-highlight">Subordinate</span> (follower). Roles powerfully shape behavior.</p>
                    </div>
                    <div class="concept-card">
                        <h3>💰 Monetary Incentives</h3>
                        <p>External rewards that motivate behavior. This experiment contrasts <span class="theory-highlight">Bonus</span> conditions (cash rewards) with <span class="theory-highlight">No Bonus</span> conditions (reputation points only).</p>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-next" onclick="showSection('consent')">Continue</button>
                </div>
            </div>
            
            <!-- Consent Section -->
            <div class="section" id="consent">
                <h2>Participant Consent</h2>
                <p>Before we begin, please review and acknowledge the following information about this experiment:</p>
                
                <div class="experiment-info">
                    <h3>About This Simulation:</h3>
                    <ul>
                        <li>This is an interactive simulation of psychological research</li>
                        <li>You will be randomly assigned to an experimental condition</li>
                        <li>You'll complete resource allocation tasks and make decisions</li>
                        <li>All data is anonymous and stored only in your browser</li>
                        <li>You may withdraw at any time by closing your browser</li>
                    </ul>
                    
                    <h3>Ethical Considerations:</h3>
                    <p>This simulation follows ethical guidelines for psychological research, this simulation includes:</p>
                    <ul>
                        <li>Full informed consent</li>
                        <li>Right to withdraw at any time</li>
                        <li>Comprehensive debriefing</li>
                        <li>No psychological harm</li>
                    </ul>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-prev" onclick="showSection('intro')">Back</button>
                    <button class="btn btn-next" onclick="assignCondition(); showSection('condition')">I Consent & Continue</button>
                </div>
            </div>
            
            <!-- Condition Assignment -->
            <div class="section" id="condition">
                <h2>Your Experimental Condition</h2>
                <p>You have been randomly assigned to one of eight experimental conditions based on the 2×2×2 factorial design:</p>
                
                <div class="condition-display" id="conditionDisplay">
                    <!-- Condition will be displayed here -->
                </div>
                
                <div class="task-container">
                    <h3>Your Role & Responsibilities</h3>
                    <p id="roleDescription">Based on your condition, you'll have specific responsibilities in the resource allocation tasks.</p>
                    
                    <h3>Incentive Structure</h3>
                    <p id="incentiveDescription">Your decisions will impact either cash bonuses or reputation points.</p>
                    
                    <h3>Power Level</h3>
                    <p id="powerDescription">Your level of control over resource allocation decisions.</p>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-prev" onclick="showSection('consent')">Back</button>
                    <button class="btn btn-next" onclick="showSection('empathy')">Continue</button>
                </div>
            </div>
            
            <!-- Empathy Assessment -->
            <div class="section" id="empathy">
                <h2>Empathy Assessment</h2>
                <p>Please respond to the following statements based on how well they describe you. This assessment helps us understand how empathy moderates decision-making.</p>
                
                <div class="task-container">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>I often have tender, concerned feelings for people less fortunate than me</span>
                            <span id="empathyValue1">3</span>
                        </div>
                        <input type="range" min="1" max="5" value="3" class="slider" id="empathy1" oninput="updateSliderValue('empathy1', 'empathyValue1')">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>I sometimes find it difficult to see things from another person's point of view</span>
                            <span id="empathyValue2">3</span>
                        </div>
                        <input type="range" min="1" max="5" value="3" class="slider" id="empathy2" oninput="updateSliderValue('empathy2', 'empathyValue2')">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>When I see someone being treated unfairly, I sometimes don't feel very much pity for them</span>
                            <span id="empathyValue3">3</span>
                        </div>
                        <input type="range" min="1" max="5" value="3" class="slider" id="empathy3" oninput="updateSliderValue('empathy3', 'empathyValue3')">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>I try to look at everybody's side of a disagreement before I make a decision</span>
                            <span id="empathyValue4">3</span>
                        </div>
                        <input type="range" min="1" max="5" value="3" class="slider" id="empathy4" oninput="updateSliderValue('empathy4', 'empathyValue4')">
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-prev" onclick="showSection('condition')">Back</button>
                    <button class="btn btn-next" onclick="calculateEmpathy(); showSection('allocation')">Continue to Task</button>
                </div>
            </div>
            
            <!-- Resource Allocation Task -->
            <div class="section" id="allocation">
                <h2>Resource Allocation Task</h2>
                <p id="allocationInstructions">You need to distribute <strong>100 resource units</strong> among three group members. The resources will be used for a group project.</p>
                
                <div class="round-indicator" id="allocationRound">Round 1 of 10</div>
                
                <div class="allocation-display">
                    <div class="participant-box">
                        <h3>Participant A</h3>
                        <div class="points-display" id="pointsA">0</div>
                        <p>Role: Marketing Specialist</p>
                    </div>
                    
                    <div class="participant-box self">
                        <h3>You</h3>
                        <div class="points-display" id="pointsSelf">0</div>
                        <p id="playerRole">Role: Team Leader</p>
                    </div>
                    
                    <div class="participant-box">
                        <h3>Participant B</h3>
                        <div class="points-display" id="pointsB">0</div>
                        <p>Role: Technical Expert</p>
                    </div>
                </div>
                
                <div class="task-container">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Allocate to Participant A</span>
                            <span id="valueA">0</span>
                        </div>
                        <input type="range" min="0" max="100" value="0" class="slider" id="sliderA" oninput="updateAllocation()">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Allocate to Yourself</span>
                            <span id="valueSelf">0</span>
                        </div>
                        <input type="range" min="0" max="100" value="0" class="slider" id="sliderSelf" oninput="updateAllocation()">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Allocate to Participant B</span>
                            <span id="valueB">0</span>
                        </div>
                        <input type="range" min="0" max="100" value="0" class="slider" id="sliderB" oninput="updateAllocation()">
                    </div>
                    
                    <div class="slider-container">
                        <div style="text-align: center; margin-top: 20px; font-weight: bold;">
                            Total: <span id="totalPoints">0</span>/100
                        </div>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-prev" onclick="prevAllocation()">Previous</button>
                    <button class="btn btn-next" id="nextAllocationBtn" onclick="nextAllocation()">Next Allocation</button>
                </div>
            </div>
            
            <!-- Penalty Choice Task -->
            <div class="section" id="penalty">
                <h2>Penalty Choice Task</h2>
                <p id="penaltyScenario">Participant B has submitted their work late for the third time this month, causing delays for the entire team.</p>
                
                <div class="round-indicator" id="penaltyRound">Scenario 1 of 5</div>
                
                <div class="task-container">
                    <h3>How would you respond?</h3>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <button class="btn" style="background: #e74c3c; padding: 15px 40px; margin: 10px;" onclick="recordPenaltyChoice(true)">Impose Penalty</button>
                        <button class="btn" style="background: #2ecc71; padding: 15px 40px; margin: 10px;" onclick="recordPenaltyChoice(false)">No Penalty</button>
                    </div>
                    
                    <div class="experiment-info">
                        <p><strong>Penalty consequences:</strong> A penalty would reduce the participant's bonus by 20% but improve project efficiency. Not imposing a penalty maintains group harmony but may encourage future delays.</p>
                    </div>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-prev" onclick="prevPenalty()">Previous</button>
                    <button class="btn" id="nextPenaltyBtn" style="display: none;" onclick="nextPenalty()">Next Scenario</button>
                </div>
            </div>
            
            <!-- Results Section -->
            <div class="section" id="results">
                <h2>Your Experimental Results</h2>
                
                <div class="condition-display" id="resultsCondition">
                    <!-- Condition will be displayed here -->
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Self-Serving Behavior</h3>
                        <div class="result-value" id="selfServingScore">0%</div>
                        <p>Average percentage of resources allocated to yourself</p>
                        <p class="comparison" id="selfServingComparison">Comparison to your condition average: 0%</p>
                    </div>
                    
                    <div class="result-card">
                        <h3>Punitive Behavior</h3>
                        <div class="result-value" id="punitiveScore">0</div>
                        <p>Number of times you chose to impose penalties</p>
                        <p class="comparison" id="punitiveComparison">Comparison to your condition average: 0</p>
                    </div>
                    
                    <div class="result-card">
                        <h3>Empathy Score</h3>
                        <div class="result-value" id="empathyScore">0.0</div>
                        <p>Based on your empathy assessment</p>
                        <p class="comparison">Higher scores indicate greater empathy</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 40px;">Behavior Comparison by Condition</h3>
                <div class="chart-container">
                    <canvas id="resultsChart"></canvas>
                </div>
                
                <div class="debrief">
                    <h3>Debriefing & Insights</h3>
                    <p>This experiment demonstrates how situational factors like power, roles, and incentives can influence behavior. Your results show how these factors affected your decisions compared to others in similar situations.</p>
                    <p>Research indicates that the combination of authority roles, high control, and financial incentives creates conditions where self-serving behavior is most likely. Empathy appears to moderate these effects - individuals with higher empathy scores tend to show less self-serving behavior even in high-power roles.</p>
                    <p>These findings have important implications for organizational design, suggesting that checks and balances, empathy training, and careful incentive structures can help prevent unethical behavior in positions of power.</p>
                </div>
                
                <div class="btn-container">
                    <button class="btn btn-prev" onclick="showSection('penalty')">Back</button>
                    <button class="btn" onclick="location.reload()">Restart Experiment</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>The Michael 9 Grant Experiment | Psychological Simulation | For Educational Purposes Only</p>
            <p>This interactive demonstration is based on established psychological principles and research designs</p>
        </footer>
    </div>

    <script>
        // Experiment state management
        const experimentState = {
            currentSection: 'intro',
            condition: {},
            empathyScore: 0,
            allocationRounds: [],
            penaltyChoices: [],
            currentAllocationRound: 1,
            currentPenaltyRound: 1,
            selfServingAverage: 0,
            punitiveCount: 0
        };
        
        // Condition definitions
        const conditions = [
            { power: "High-control", role: "Authority", incentive: "Bonus", color: "#e74c3c" },
            { power: "High-control", role: "Authority", incentive: "No Bonus", color: "#e67e22" },
            { power: "High-control", role: "Subordinate", incentive: "Bonus", color: "#f1c40f" },
            { power: "High-control", role: "Subordinate", incentive: "No Bonus", color: "#2ecc71" },
            { power: "Low-control", role: "Authority", incentive: "Bonus", color: "#1abc9c" },
            { power: "Low-control", role: "Authority", incentive: "No Bonus", color: "#3498db" },
            { power: "Low-control", role: "Subordinate", incentive: "Bonus", color: "#9b59b6" },
            { power: "Low-control", role: "Subordinate", incentive: "No Bonus", color: "#34495e" }
        ];
        
        // Projected results for each condition (self-serving behavior %)
        const projectedResults = {
            "High-control_Authority_Bonus": 85,
            "High-control_Authority_No Bonus": 70,
            "High-control_Subordinate_Bonus": 60,
            "High-control_Subordinate_No Bonus": 50,
            "Low-control_Authority_Bonus": 65,
            "Low-control_Authority_No Bonus": 45,
            "Low-control_Subordinate_Bonus": 55,
            "Low-control_Subordinate_No Bonus": 30
        };
        
        // Projected punitive behavior counts
        const projectedPunitive = {
            "High-control_Authority_Bonus": 4.2,
            "High-control_Authority_No Bonus": 3.5,
            "High-control_Subordinate_Bonus": 3.0,
            "High-control_Subordinate_No Bonus": 2.5,
            "Low-control_Authority_Bonus": 3.2,
            "Low-control_Authority_No Bonus": 2.0,
            "Low-control_Subordinate_Bonus": 2.8,
            "Low-control_Subordinate_No Bonus": 1.8
        };
        
        // Section navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            experimentState.currentSection = sectionId;
            updateProgressBar();
            
            // Special handling for certain sections
            if (sectionId === 'condition') {
                displayCondition();
            } else if (sectionId === 'allocation') {
                resetAllocationSliders();
                document.getElementById('allocationRound').textContent = `Round ${experimentState.currentAllocationRound} of 10`;
            } else if (sectionId === 'penalty') {
                updatePenaltyScenario();
                document.getElementById('penaltyRound').textContent = `Scenario ${experimentState.currentPenaltyRound} of 5`;
                document.getElementById('nextPenaltyBtn').style.display = 'none';
            } else if (sectionId === 'results') {
                calculateResults();
                displayResults();
            }
        }
        
        // Update progress bar based on current section
        function updateProgressBar() {
            const sections = ['intro', 'consent', 'condition', 'empathy', 'allocation', 'penalty', 'results'];
            const currentIndex = sections.indexOf(experimentState.currentSection);
            const progress = ((currentIndex + 1) / sections.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }
        
        // Randomly assign condition
        function assignCondition() {
            const randomIndex = Math.floor(Math.random() * conditions.length);
            experimentState.condition = {...conditions[randomIndex]};
        }
        
        // Display assigned condition
        function displayCondition() {
            const { power, role, incentive } = experimentState.condition;
            const conditionDisplay = document.getElementById('conditionDisplay');
            const roleDesc = document.getElementById('roleDescription');
            const incentiveDesc = document.getElementById('incentiveDescription');
            const powerDesc = document.getElementById('powerDescription');
            
            conditionDisplay.innerHTML = `
                <div style="font-size: 1.5rem; margin-bottom: 10px;">${role} Role</div>
                <div>Power: ${power}</div>
                <div>Incentive: ${incentive}</div>
            `;
            
            roleDesc.innerHTML = `
                As the <strong>${role}</strong>, you ${role === 'Authority' ? 
                'are responsible for making final decisions and overseeing the group' : 
                'will follow directions and contribute to group tasks'}.
            `;
            
            incentiveDesc.innerHTML = `
                This is a <strong>${incentive}</strong> condition. ${incentive === 'Bonus' ? 
                'Your decisions will impact real cash bonuses for yourself and others' : 
                'Your decisions will only affect reputation points with no financial impact'}.
            `;
            
            powerDesc.innerHTML = `
                You have <strong>${power}</strong>. ${power === 'High-control' ? 
                'You have decisive authority to make allocation decisions' : 
                'You can make recommendations, but final decisions will be made by others'}.
            `;
        }
        
        // Update slider value display
        function updateSliderValue(sliderId, valueId) {
            const value = document.getElementById(sliderId).value;
            document.getElementById(valueId).textContent = value;
        }
        
        // Calculate empathy score
        function calculateEmpathy() {
            const empathy1 = parseInt(document.getElementById('empathy1').value);
            const empathy2 = 6 - parseInt(document.getElementById('empathy2').value); // Reverse scored
            const empathy3 = 6 - parseInt(document.getElementById('empathy3').value); // Reverse scored
            const empathy4 = parseInt(document.getElementById('empathy4').value);
            
            experimentState.empathyScore = ((empathy1 + empathy2 + empathy3 + empathy4) / 4).toFixed(1);
        }
        
        // Allocation task functions
        function resetAllocationSliders() {
            document.getElementById('sliderA').value = 0;
            document.getElementById('sliderSelf').value = 0;
            document.getElementById('sliderB').value = 0;
            updateAllocation();
        }
        
        function updateAllocation() {
            const sliderA = parseInt(document.getElementById('sliderA').value);
            const sliderSelf = parseInt(document.getElementById('sliderSelf').value);
            const sliderB = parseInt(document.getElementById('sliderB').value);
            const total = sliderA + sliderSelf + sliderB;
            
            document.getElementById('valueA').textContent = sliderA;
            document.getElementById('valueSelf').textContent = sliderSelf;
            document.getElementById('valueB').textContent = sliderB;
            document.getElementById('pointsA').textContent = sliderA;
            document.getElementById('pointsSelf').textContent = sliderSelf;
            document.getElementById('pointsB').textContent = sliderB;
            document.getElementById('totalPoints').textContent = total;
            
            // Enable/disable next button based on total
            document.getElementById('nextAllocationBtn').disabled = total !== 100;
        }
        
        function nextAllocation() {
            // Save current allocation
            const allocation = {
                a: parseInt(document.getElementById('sliderA').value),
                self: parseInt(document.getElementById('sliderSelf').value),
                b: parseInt(document.getElementById('sliderB').value)
            };
            
            experimentState.allocationRounds.push(allocation);
            
            // Move to next round or next section
            if (experimentState.currentAllocationRound < 10) {
                experimentState.currentAllocationRound++;
                document.getElementById('allocationRound').textContent = `Round ${experimentState.currentAllocationRound} of 10`;
                resetAllocationSliders();
            } else {
                showSection('penalty');
            }
        }
        
        function prevAllocation() {
            if (experimentState.currentAllocationRound > 1) {
                experimentState.currentAllocationRound--;
                document.getElementById('allocationRound').textContent = `Round ${experimentState.currentAllocationRound} of 10`;
                
                // Restore previous allocation if available
                if (experimentState.allocationRounds.length >= experimentState.currentAllocationRound) {
                    const prevAllocation = experimentState.allocationRounds[experimentState.currentAllocationRound - 1];
                    document.getElementById('sliderA').value = prevAllocation.a;
                    document.getElementById('sliderSelf').value = prevAllocation.self;
                    document.getElementById('sliderB').value = prevAllocation.b;
                    updateAllocation();
                } else {
                    resetAllocationSliders();
                }
            } else {
                showSection('empathy');
            }
        }
        
        // Penalty task functions
        function updatePenaltyScenario() {
            const scenarios = [
                "Participant B has submitted their work late for the third time this month, causing delays for the entire team.",
                "Participant A was overheard making negative comments about your leadership to other team members.",
                "A critical error was found in Participant A's work that requires significant time to fix before the deadline.",
                "Participant B has been taking extended breaks and not meeting their productivity targets.",
                "Participant A challenged your decision in front of the rest of the team during a meeting."
            ];
            
            document.getElementById('penaltyScenario').textContent = 
                scenarios[experimentState.currentPenaltyRound - 1];
        }
        
        function recordPenaltyChoice(penalty) {
            experimentState.penaltyChoices.push(penalty);
            document.getElementById('nextPenaltyBtn').style.display = 'block';
        }
        
        function nextPenalty() {
            if (experimentState.currentPenaltyRound < 5) {
                experimentState.currentPenaltyRound++;
                document.getElementById('penaltyRound').textContent = `Scenario ${experimentState.currentPenaltyRound} of 5`;
                document.getElementById('nextPenaltyBtn').style.display = 'none';
                updatePenaltyScenario();
            } else {
                showSection('results');
            }
        }
        
        function prevPenalty() {
            if (experimentState.currentPenaltyRound > 1) {
                experimentState.currentPenaltyRound--;
                document.getElementById('penaltyRound').textContent = `Scenario ${experimentState.currentPenaltyRound} of 5`;
                document.getElementById('nextPenaltyBtn').style.display = 'none';
                
                // Remove last choice if going back
                if (experimentState.penaltyChoices.length >= experimentState.currentPenaltyRound) {
                    experimentState.penaltyChoices.pop();
                }
                
                updatePenaltyScenario();
            } else {
                showSection('allocation');
            }
        }
        
        // Calculate final results
        function calculateResults() {
            // Calculate self-serving behavior average
            let totalSelfAllocation = 0;
            experimentState.allocationRounds.forEach(allocation => {
                totalSelfAllocation += allocation.self;
            });
            experimentState.selfServingAverage = (totalSelfAllocation / 10).toFixed(1);
            
            // Calculate punitive behavior count
            experimentState.punitiveCount = experimentState.penaltyChoices.filter(choice => choice).length;
        }
        
        // Display results
        function displayResults() {
            const { power, role, incentive } = experimentState.condition;
            const conditionKey = `${power}_${role}_${incentive.replace(' ', '_')}`;
            const projectedSelfServing = projectedResults[conditionKey];
            const projectedPunitiveAvg = projectedPunitive[conditionKey];
            
            // Display condition
            document.getElementById('resultsCondition').innerHTML = `
                <div style="font-size: 1.5rem; margin-bottom: 10px;">${role} Role | ${power} | ${incentive}</div>
            `;
            
            // Display scores
            document.getElementById('selfServingScore').textContent = `${experimentState.selfServingAverage}%`;
            document.getElementById('punitiveScore').textContent = experimentState.punitiveCount;
            document.getElementById('empathyScore').textContent = experimentState.empathyScore;
            
            // Comparisons
            document.getElementById('selfServingComparison').textContent = 
                `Comparison to your condition average: ${projectedSelfServing}%`;
                
            document.getElementById('punitiveComparison').textContent = 
                `Comparison to your condition average: ${projectedPunitiveAvg.toFixed(1)}`;
            
            // Create chart
            createResultsChart(projectedSelfServing, projectedPunitiveAvg);
        }
        
        // Create results chart
        function createResultsChart(projectedSelf, projectedPunitive) {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.resultsChart) {
                window.resultsChart.destroy();
            }
            
            window.resultsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Self-Serving Behavior', 'Punitive Behavior'],
                    datasets: [
                        {
                            label: 'Your Results',
                            data: [experimentState.selfServingAverage, experimentState.punitiveCount],
                            backgroundColor: experimentState.condition.color,
                            borderColor: 'rgba(0, 0, 0, 0.2)',
                            borderWidth: 1
                        },
                        {
                            label: 'Condition Average',
                            data: [projectedSelf, projectedPunitive],
                            backgroundColor: '#95a5a6',
                            borderColor: 'rgba(0, 0, 0, 0.2)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Score'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Your Behavior vs. Condition Average',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }
        
        // Initialize the experiment
        window.onload = function() {
            updateProgressBar();
            document.getElementById('playerRole').textContent = `Role: Team Leader`;
        };
    </script>
</body>
</html>